#!/usr/bin/env bash

function ZSHENV() {  # {{{
  ACT="$1"
  SRC="${HOME}/projects/reserved/program/zshenv/zshenv"
  TGT="${HOME}/.zshenv"
  case "$ACT" in
  -i | --install)
    if [ -f "$SRC" ]; then
      if ! [ -L "$TGT" ]; then
        ln -s "$SRC" "$TGT"
        mkdir -p "${HOME}/.cache/zsh"
      fi
    fi
    ;;
  -u | --uninstall)
    if [ -L "$TGT" ]; then
      unlink "$TGT"
      [ -d "${HOME}/.cache/zsh" ] && rm -rf "${HOME}/.cache/zsh"
    fi
    ;;
  esac
}  # }}}

function SOURCE() {  # {{{
  SRC1='reserved'
  SRC2='dotfiles'

  declare -A ORIG

  ORIG[abookrc]="$SRC1"
  ORIG[bread]="$SRC1"
  ORIG[git]="$SRC1"
  ORIG[irssi]="$SRC1"
  ORIG[mutt]="$SRC1"

  ORIG[alacritty]="$SRC2"
  ORIG[awesome]="$SRC2"
  ORIG[conky]="$SRC2"
  ORIG[containers]="$SRC2"
  ORIG[emacs]="$SRC2"
  ORIG[kanata_cfg]="$SRC2"
  ORIG[kanata_ctl]="$SRC2"
  ORIG[kitty]="$SRC2"
  ORIG[newsboat]="$SRC2"
  ORIG[nvim]="$SRC2"
  ORIG[opencode]="$SRC1"
  ORIG[tmux]="$SRC2"
  ORIG[vifm]="$SRC2"
  ORIG[vim]="$SRC2"
  ORIG[zathura]="$SRC2"
  ORIG[zsh]="$SRC2"

  PKG="$1"
  echo "${HOME}/projects/${ORIG[$PKG]}/program"
}  # }}}

function TARGET() {  # {{{
  declare -A DEST

  DEST[abookrc]='.config/abook'
  DEST[bread]='.local/share/bookmarks'
  DEST[git]='.config/git'
  DEST[irssi]='.config/irssi'
  DEST[mutt]='.config/mutt'

  DEST[alacritty]='.config/alacritty'
  DEST[awesome]='.config/awesome'
  DEST[conky]='.config/conky'
  DEST[containers]='.config/containers'
  DEST[emacs]='.config/emacs'
  DEST[kanata_cfg]='.config/kanata'
  DEST[kanata_ctl]='.config/systemd/user'
  DEST[kitty]='.config/kitty'
  DEST[newsboat]='.config/newsboat'
  DEST[nvim]='.config/nvim'
  DEST[opencode]='.config/opencode'
  DEST[tmux]='.config/tmux'
  DEST[vifm]='.config/vifm'
  DEST[vim]='.config/vim'
  DEST[zathura]='.config/zathura'
  DEST[zsh]='.config/zsh'

  PKG="$1"
  echo "${HOME}/${DEST[$PKG]}"
}  # }}}

function INSTALL() {  # {{{
  PKG="$1"
  SRC=$(SOURCE "$PKG")
  TGT=$(TARGET "$PKG")
  [ -d "$TGT" ] && exit 2
  mkdir -p "$TGT"
  stow --restow --dir="$SRC" --target="$TGT" "$PKG"
  [ "$PKG" == 'zsh' ] && ZSHENV --install
}  # }}}

function UNINSTALL() {  # {{{
  PKG="$1"
  SRC=$(SOURCE "$PKG")
  TGT=$(TARGET "$PKG")
  [ -d "$TGT" ] || exit 3
  stow --delete --dir="$SRC" --target="$TGT" "$PKG"
  rm -rf "$TGT"
  [ "$PKG" == 'zsh' ] && ZSHENV --uninstall
}  # }}}

# AVAILABLE_DOTFILES {{{
function AVAILABLE_DOTFILES() {
  printf 'There are dotfiles currently available for the following programs:\n
  \t- abook
  \t- alacritty
  \t- awesome
  \t- bread
  \t- conky
  \t- containers
  \t- emacs
  \t- git
  \t- irssi
  \t- kanata
  \t- kitty
  \t- mutt
  \t- newsboat
  \t- nvim
  \t- opencode
  \t- tmux
  \t- vifm
  \t- vim
  \t- zathura
  \t- zsh\n\n'
}  # }}}

function HELP() {  # {{{
  echo 'Help message'
}  # }}}

# Where all the magic actually happens {{{
if [ "$#" -eq 2 ]; then
  ACT="$1"
  PKG="$2"
  case "$ACT" in
  -i | --install)
    case "$PKG" in
    abook)
      INSTALL abookrc
      ;;
    bread)
      INSTALL bread
      ;;
    git)
      INSTALL git
      ;;
    irssi)
      INSTALL irssi
      ;;
    mutt)
      INSTALL mutt
      ;;
    alacritty)
      INSTALL alacritty
      ;;
    awesome)
      INSTALL awesome
      ;;
    conky)
      INSTALL conky
      ;;
    containers)
      INSTALL containers
      ;;
    emacs)
      INSTALL emacs
      ;;
    kanata)
      INSTALL kanata_cfg
      INSTALL kanata_ctl
      ;;
    kitty)
      INSTALL kitty
      ;;
    newsboat)
      INSTALL newsboat
      ;;
    nvim)
      INSTALL nvim
      ;;
    opencode)
      INSTALL opencode
      ;;
    tmux)
      INSTALL tmux
      ;;
    vifm)
      INSTALL vifm
      ;;
    vim)
      INSTALL vim
      ;;
    zathura)
      INSTALL zathura
      ;;
    zsh)
      INSTALL zsh
      ;;
    all)
      INSTALL abookrc
      INSTALL alacritty
      INSTALL awesome
      INSTALL bread
      INSTALL conky
      INSTALL containers
      INSTALL emacs
      INSTALL git
      INSTALL irssi
      INSTALL kanata_cfg
      INSTALL kanata_ctl
      INSTALL kitty
      INSTALL mutt
      INSTALL newsboat
      INSTALL nvim
      INSTALL opencode
      INSTALL tmux
      INSTALL vifm
      INSTALL vim
      INSTALL zathura
      INSTALL zsh
      ;;
    *)
      AVAILABLE_DOTFILES
      ;;
    esac
    ;;
  -u | --uninstall)
    case "$PKG" in
    abook)
      UNINSTALL abookrc
      ;;
    bread)
      UNINSTALL bread
      ;;
    git)
      UNINSTALL git
      ;;
    irssi)
      UNINSTALL irssi
      ;;
    mutt)
      UNINSTALL mutt
      ;;
    alacritty)
      UNINSTALL alacritty
      ;;
    awesome)
      UNINSTALL awesome
      ;;
    conky)
      UNINSTALL conky
      ;;
    containers)
      UNINSTALL containers
      ;;
    emacs)
      UNINSTALL emacs
      ;;
    kanata)
      UNINSTALL kanata_cfg
      UNINSTALL kanata_ctl
      ;;
    kitty)
      UNINSTALL kitty
      ;;
    newsboat)
      UNINSTALL newsboat
      ;;
    nvim)
      UNINSTALL nvim
      ;;
    opencode)
      UNINSTALL opencode
      ;;
    tmux)
      UNINSTALL tmux
      ;;
    vifm)
      UNINSTALL vifm
      ;;
    vim)
      UNINSTALL vim
      ;;
    zathura)
      UNINSTALL zathura
      ;;
    zsh)
      UNINSTALL zsh
      ;;
    all)
      UNINSTALL abookrc
      UNINSTALL alacritty
      UNINSTALL awesome
      UNINSTALL bread
      UNINSTALL conky
      UNINSTALL containers
      UNINSTALL emacs
      UNINSTALL git
      UNINSTALL irssi
      UNINSTALL kanata_cfg
      UNINSTALL kanata_ctl
      UNINSTALL kitty
      UNINSTALL mutt
      UNINSTALL newsboat
      UNINSTALL nvim
      UNINSTALL opencode
      UNINSTALL tmux
      UNINSTALL vifm
      UNINSTALL vim
      UNINSTALL zathura
      UNINSTALL zsh
      ;;
    *)
      AVAILABLE_DOTFILES
      ;;
    esac
    ;;
  *)
    HELP
    ;;
  esac
else
  HELP
fi
# }}}

exit 0

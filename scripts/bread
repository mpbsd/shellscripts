#!/usr/bin/env bash

set -e

WBROWSER='/usr/bin/chromium'
DATABASE="${HOME}/.local/share/bookmarks/bookmarks.json"

CATEGORY=$(
  jq '. | keys' <"$DATABASE" |
    sed -n '/^[^][]/p' |
    sed 's/[][", ]//g' |
    fzf
)

[ -n "$CATEGORY" ] || exit 101

BOOKMARK=$(
  jq '.'"$CATEGORY"' | keys[] as $k | "\($k): \(.[$k].dsc)"' <"$DATABASE" |
    sed -n '/^[^][]/p' |
    sed 's/[][", ]//g' |
    fzf |
    cut -d':' -f1
)

[ -n "$BOOKMARK" ] || exit 102

ADDRESS=$(
  JQ=$(printf '.%s["%s"]["url"]' "$CATEGORY" "$BOOKMARK")
  jq "$JQ" <"$DATABASE" | sed 's/"//g'
)

[ -n "$ADDRESS" ] || exit 103

"$WBROWSER" "$ADDRESS" &

exit 0
